<?xml version="1.0" encoding="utf-8"?>
<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <parameters>
        <parameter key="logger.sensor.log">logs/sensor.log</parameter>
        <parameter key="application.name">homie</parameter>
        <parameter key="application.registration_enabled">true</parameter>

        <parameter key="gpio.executable">gpio</parameter>

        <parameter key="filesystem.remote.url"/>
        <parameter key="filesystem.remote.username"/>
        <parameter key="filesystem.remote.password"/>
        <parameter key="filesystem.remote.pathPrefix"/>
        <parameter key="filesystem.remote.cache">false</parameter>
    </parameters>
    <services>
        <service id="HomieClient" alias="HomieClient.Local" public="false"/>

        <service id="RemoteFilesystem" class="League\Flysystem\Filesystem" public="false">
            <argument type="service">
                <service class="League\Flysystem\Adapter\Local">
                    <argument>%cache.dir%filesystem/</argument>
                </service>
            </argument>
        </service>

        <service id="WebdavRemoteFilesystem" class="League\Flysystem\Filesystem" public="false">
            <argument type="service">
                <service class="League\Flysystem\WebDAV\WebDAVAdapter">
                    <argument type="service">
                        <service class="Sabre\DAV\Client">
                            <argument type="collection">
                                <argument key="userName">%filesystem.remote.username%</argument>
                                <argument key="password">%filesystem.remote.password%</argument>
                                <argument key="baseUri">%filesystem.remote.url%</argument>
                                <argument key="authType">1</argument>
                            </argument>
                            <call method="addCurlSetting">
                                <argument type="constant">CURLOPT_SSL_VERIFYHOST</argument>
                                <argument>0</argument>
                            </call>
                            <call method="addCurlSetting">
                                <argument type="constant">CURLOPT_SSL_VERIFYPEER</argument>
                                <argument>0</argument>
                            </call>
                        </service>
                    </argument>
                    <call method="setPathPrefix"><argument>%filesystem.remote.pathPrefix%</argument></call>
                </service>
            </argument>
        </service>
        <service id="CachedRemoteFilesystem" class="League\Flysystem\Filesystem" public="false">
            <argument type="service">
                <service class="League\Flysystem\Cached\CachedAdapter">
                    <argument type="service">
                        <service class="League\Flysystem\WebDAV\WebDAVAdapter">
                            <argument type="service">
                                <service class="Sabre\DAV\Client">
                                    <argument type="collection">
                                        <argument key="userName">%filesystem.remote.username%</argument>
                                        <argument key="password">%filesystem.remote.password%</argument>
                                        <argument key="baseUri">%filesystem.remote.url%</argument>
                                        <argument key="authType">1</argument>
                                    </argument>
                                    <call method="addCurlSetting">
                                        <argument type="constant">CURLOPT_SSL_VERIFYHOST</argument>
                                        <argument>0</argument>
                                    </call>
                                    <call method="addCurlSetting">
                                        <argument type="constant">CURLOPT_SSL_VERIFYPEER</argument>
                                        <argument>0</argument>
                                    </call>
                                </service>
                            </argument>
                            <call method="setPathPrefix"><argument>%filesystem.remote.pathPrefix%</argument></call>
                        </service>
                    </argument>
                    <argument type="service">
                        <service class="League\Flysystem\Cached\Storage\Predis">
                            <argument type="service" id="redis"/>
                        </service>
                    </argument>
                </service>
            </argument>
        </service>
    </services>
</container>
