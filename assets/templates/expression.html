
<form style="width: 400px;" role="form">
	<h2 translate>Expression</h2>
    <div class="form-group">
        <label for="expressionConditionField" translate>Condition</label>
        <autocomplete
            id="expressionConditionField"
            ng-model="editExpression.condition"
            attrInputClass="form-control"
            on-type="autocompleteCondition"
            ng-enter="saveExpression(editExpression)"
            data="suggestionsCondition"
            placeholder="{{'Condition'|translate}}"
        ></autocomplete>
    </div>

    <div class="form-group">
        <label translate>Actions</label>
        <div class="form-inline" ng-repeat="(key, action) in editExpression.actions track by $index">
            <label class="pull-left">{{ $index + 1 }}.) </label>
            <autocomplete
                    ng-model="editExpression.actions[$index]"
                    attrInputClass="form-control"
                    on-type="autocompleteAction"
                    placeholder="{{'Action'|translate}}"
                    required
                    data="suggestionsActions"
            ></autocomplete>
            <a
                    ng-show="action && $index == editExpression.actions.length - 1"
                    class="pull-left form-control glyphicon glyphicon-plus"
                    ng-click="addAction(editExpression)"
            ></a>
            <a
                    ng-show="$index > 0"
                    class="pull-left form-control glyphicon glyphicon-minus"
                    ng-click="deleteAction($index)"
            ></a>
            <span class="clearfix"></span>
        </div>
    </div>

	<button
            class="btn btn-lg btn-primary btn-block"
            ng-disabled="pending"
            ng-click="save(editExpression)"
            type="button"
            translate
    >
        Save
    </button>
</form>

<hr />
<table ng-if="expressions|notEmpty" class="table table-bordered table-striped table-hover">
	<thead>
		<tr>
            <th translate>Counter</th>
			<th translate>Payload</th>
			<th translate>Condition</th>
			<th translate>Actions</th>
			<th><span class="glyphicon glyphicon-edit"></span></th>
			<th><span class="glyphicon glyphicon-remove"></span></th>
		</tr>
	</thead>
	<tbody>
		<tr ng-repeat="(expressionId, expression) in expressions">
			<td>{{ expression.counter }}</td>
			<td>
                <ul>
                    <li ng-repeat="(key, value) in expression.payload">{{key}}: {{ value }}</li>
                </ul>
            </td>
			<td>{{ expression.condition }}</td>
			<td>
                <ul>
                    <li ng-repeat="action in expression.actions">{{ action }}</li>
                </ul>
			</td>
			<td>
				<a
                        ng-click="edit(expression)"
                        class="glyphicon glyphicon-edit cursor"
                ></a>
			</td>
			<td>
				<a ng-click="delete(expressionId)" class="glyphicon glyphicon-remove"></a>
			</td>
		</tr>
	</tbody>
</table>

<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th translate>Cron-ID</th>
            <th translate>Next Run</th>
            <th translate>Expression</th>
            <th translate>Delete</th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat="cron in crons">
            <th>
                <span class="tip">{{ cron.event.event.timingId }}</span>
            </th>
            <th>{{ cron.timestamp|timeAgo }}</th>
            <th>{{ cron.event.expression}}</th>
            <td>
                <a ng-click="deleteTimer(cron.eventId)" class="glyphicon glyphicon-remove"></a>
            </td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <th>
                <input
                        type="text"
                        placeholder="{{'e.g. @daily, or 2 * * * *'|translate}}"
                        ng-click="addCron(cron)"
                        ng-model="cron.cronId"
                        class="form-control"/>
            </th>
            <th colspan="2">
                <input
                        type="text"
                        placeholder="{{'Expression'|translate}}"
                        ng-click="addCron(cron)"
                        ng-model="cron.expression"
                        class="form-control"/>
            </th>
            <th>
                <input
                        type="button"
                        ng-click="addCron(cron)"
                        class="btn btn-primary"
                        value="{{'Add'|translate}}" />
            </th>
        </tr>
    </tfoot>
</table>
